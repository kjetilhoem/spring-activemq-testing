<?xml version="1.0" encoding="UTF-8"?>
<beans default-autowire="no" xmlns="http://www.springframework.org/schema/beans" xmlns:p="http://www.springframework.org/schema/p"
    xmlns:jms="http://www.springframework.org/schema/integration/jms"
    xmlns:int="http://www.springframework.org/schema/integration"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/integration/jms
    http://www.springframework.org/schema/integration/jms/spring-integration-jms-2.0.xsd
    http://www.springframework.org/schema/integration
    http://www.springframework.org/schema/integration/spring-integration-2.0.xsd
    http://www.springframework.org/schema/tx
    http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">

    <tx:annotation-driven />

    <!-- jta/xa transaction manager setup -->    
    <bean id="atomikosTransactionManager" class="com.atomikos.icatch.jta.UserTransactionManager" 
        init-method="init" 
        destroy-method="close"
        p:forceShutdown="true"
        />
    
    <bean id="atomikosUserTransaction" class="com.atomikos.icatch.jta.UserTransactionImp"
        p:transactionTimeout="300"
        />
    
    <bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager"
        p:transactionManager-ref="atomikosTransactionManager"
        p:userTransaction-ref="atomikosUserTransaction"
        />


    <!-- Data source 1 -->
    <bean id="xads1" class="org.apache.derby.jdbc.EmbeddedXADataSource" 
        p:createDatabase="create"
        p:databaseName="db1"
        />

    <!--  TODO inline         init-method="init" 
        destroy-method="close"
    -->
    <bean id="ds1" class="com.atomikos.jdbc.AtomikosDataSourceBean" 
        p:xaDataSource-ref="xads1" 
        p:poolSize="1"
        p:uniqueResourceName="DS1"
        />


    <!-- Data source 2 -->
    <bean id="xads2" class="org.apache.derby.jdbc.EmbeddedXADataSource" 
        p:createDatabase="create"
        p:databaseName="db2" 
        />

    <bean id="ds2" class="com.atomikos.jdbc.AtomikosDataSourceBean" 
        p:xaDataSource-ref="xads2"
        p:poolSize="1"
        p:uniqueResourceName="DS2"
        />
        
        
    <!-- Testing bean -->        
    <bean id="dualDsTester" class="testing.DualDsTesterImpl" />

         
</beans>
